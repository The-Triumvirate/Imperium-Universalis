####
#	SCRIPTED EFFECTS for the Siege events. Colateral damage, enslavement, etc
#	This code uses heavily the scripted effect and "dynamic inputs", where you can add $xx$ (dollar key), and determine this in the event.
#	In your event if you write, instead of a simple scripted effect ( collateral damage = yes ) you use this: ( collateral = { hd = 20 } ) it will use this 20 inside the $hd$ field. This means that we can use the same effect below, but dependent on several % of 20, 40, 60, etc, withouth having to write one effect for each.
#	If you have doubts or comments on that, contact us on Discord. Here's the wiki resources: https://eu4.paradoxwikis.com/Commands#Scripted_Effects
####

SD_sack_devastation = {
	# Loot and inflation
	set_variable = { which = SD_looted value = $lootvalue$ }	multiply_variable = { SD_looted = 0.01 }
	multiply_variable = { which = SD_inflation which = SD_looted }
	multiply_variable = { which = SD_looted which = SD_loot }

	# Devastation
	set_variable = { which = SD_devast value = $devst$ } 		multiply_variable = { which = SD_devast which = SD_destruction } # up to 200%/300%
	set_variable = { which = SD_now_devst which = SD_devast }
	set_variable = { which = SD_colat which = SD_devast }		multiply_variable = { SD_colat = 0.01 }
	multiply_variable = { which = SD_colat which = SD_loot }	# this SD colat is the BUDGET of all value that may be destroyed: a 5%

	while = {
		limit = { check_variable = { SD_devast = 1 } }
		subtract_variable = { SD_devast = 1 } 	add_devastation = 1
	}

	# Show variables in the province modifier, to see what happened
	change_variable = { which = PS_tot_loot which = SD_looted }		# this is the historical accumulated value
	change_variable = { which = PS_tot_devst which = SD_now_devst }
}

###
#	ENSLAVEMENT EFFECTS, happening in the Siege events
###

# SD_population_loss = { loss = 25 enslave = 100 }		# an example of what is in the event

SD_population_loss = {
	# First: adapt the values to the parameters used in that option. If 0%, 25%, 50%, etc
	multiply_variable = { SD_t_lost = $loss$ } 		multiply_variable = { SD_t_lost = 0.01 }
	multiply_variable = { SD_c_lost = $loss$ } 		multiply_variable = { SD_c_lost = 0.01 }
	multiply_variable = { SD_u_lost = $loss$ } 		multiply_variable = { SD_u_lost = 0.01 }
	multiply_variable = { SD_t_slave = $enslave$ } 	multiply_variable = { SD_t_slave = 0.01 }
	multiply_variable = { SD_c_slave = $enslave$ } 	multiply_variable = { SD_c_slave = 0.01 }
	multiply_variable = { SD_u_slave = $enslave$ } 	multiply_variable = { SD_u_slave = 0.01 }

	set_variable = { which = SD_total_lost which = SD_t_lost }
	change_variable = { which = SD_total_lost which = SD_c_lost }
	change_variable = { which = SD_total_lost which = SD_u_lost }	# now saved for the province event

	set_variable = { which = SD_total_slaves which = SD_t_slave }
	change_variable = { which = SD_total_slaves which = SD_c_slave }
	change_variable = { which = SD_total_slaves which = SD_u_slave }
	multiply_variable = { SD_total_slaves = 10 }					# now saved for the province event

	# Second: move slaves. Done in a while to not lose any of them. 3.1: NOW MOVED TO "CAPTIVES"!! Must be sold or integrated
	while = {
		limit = { check_variable = { SD_t_slave = 1 } base_manpower = 2 }
		subtract_variable = { SD_t_slave = 1 } add_base_manpower = -1
		ROOT = { change_variable = { SD_captives = 10 } }
		change_variable = { PS_rur_slv = 1.0 } # statistics
	}
	if = {
		limit = { check_variable = { SD_t_slave = 0.01 } NOT = { check_variable = { SD_t_slave = 1.0 } } }	# fractional
		set_variable = { which = SD_captives which = SD_t_slave } multiply_variable = { SD_captives = 10 } 			# in province
		ROOT = { change_variable = { which = SD_captives which = PREV } }										# in the attacker country
		set_variable = { which = SD_t_slave value = 0 } set_variable = { which = SD_captives value = 0 }
	}
	else = { set_variable = { which = SD_t_slave value = 0 } }
	while = {
		limit = { check_variable = { SD_c_slave = 1 } base_production = 2 }
		subtract_variable = { SD_c_slave = 1 } add_base_production = -1
		ROOT = { change_variable = { SD_captives = 10 } }
		change_variable = { PS_urb_slv = 1.0 } # statistics
	}
	if = {
		limit = { check_variable = { SD_c_slave = 0.01 } NOT = { check_variable = { SD_c_slave = 1.0 } } }	# fractional
		set_variable = { which = SD_captives which = SD_c_slave } multiply_variable = { SD_captives = 10 }
		ROOT = { change_variable = { which = SD_captives which = PREV } }
		set_variable = { which = SD_c_slave value = 0 } set_variable = { which = SD_captives value = 0 }
	}
	else = { set_variable = { which = SD_c_slave value = 0 } }
	while = {
		limit = { check_variable = { SD_u_slave = 1 } base_tax = 2 }
		subtract_variable = { SD_u_slave = 1 } add_base_tax = -1
		ROOT = { change_variable = { SD_captives = 10 } }
		change_variable = { PS_upp_slv = 1.0 } # statistics
	}
	if = {
		limit = { check_variable = { SD_u_slave = 0.01 } NOT = { check_variable = { SD_u_slave = 1.0 } } }	# fractional
		set_variable = { which = SD_captives which = SD_u_slave } multiply_variable = { SD_captives = 10 }
		ROOT = { change_variable = { which = SD_captives which = PREV } }
		set_variable = { which = SD_u_slave value = 0 } set_variable = { which = SD_captives value = 0 }
	}
	else = { set_variable = { which = SD_u_slave value = 0 } }

	# Third: Those lost and expelled
	while = {
		limit = { check_variable = { SD_t_lost = 2 } base_manpower = 3 }
		subtract_variable = { SD_t_lost = 2 } add_base_manpower = -2		# every 2. The first escapes, the second perishes. 50%/50%
		random_neighbor_province = { SD_refugees_effect = { ref = 1 } }
		change_variable = { PS_rur_sieg = 1.0 } change_variable = { PS_rur_exp = 1.0 } # statistics
	}
	if = { 	# now if still base manpower = 2 -> same as before, escapes. There can't be a manpower 1, otherwise it would drop to zero
		limit = { check_variable = { SD_t_lost = 1 } base_manpower = 2 }
		subtract_variable = { SD_t_lost = 1 } add_base_manpower = -1
		random_neighbor_province = { SD_refugees_effect = { ref = 1 } }
		change_variable = { PS_rur_exp = 1.0 }
	}
	set_variable = { which = SD_t_lost value = 0 }

	while = {
		limit = { check_variable = { SD_c_lost = 2 } base_production = 3 }
		subtract_variable = { SD_c_lost = 2 } add_base_production = -2		# every 2. The first escapes, the second perishes. 50%/50%
		random_neighbor_province = { SD_refugees_effect = { ref = 1 } }
		change_variable = { PS_urb_sieg = 1.0 } change_variable = { PS_urb_exp = 1.0 } # statistics
	}
	if = { 	# now if still has 2 -> escapes
		limit = { check_variable = { SD_c_lost = 1 } base_production = 2 }
		subtract_variable = { SD_c_lost = 1 } add_base_production = -1
		random_neighbor_province = { SD_refugees_effect = { ref = 1 } }
		change_variable = { PS_urb_exp = 1.0 }
	}
	if = { 	# last one also is lost! back to zero
		limit = { check_variable = { SD_c_lost = 1 } base_production = 1 }
		subtract_variable = { SD_c_lost = 1 } set_base_production = 0
		change_variable = { PS_urb_sieg = 1.0 }
	}
	set_variable = { which = SD_c_lost value = 0 }

	while = {
		limit = { check_variable = { SD_u_lost = 2 } base_tax = 3 }
		subtract_variable = { SD_u_lost = 2 } add_base_tax = -2		# every 2. The first escapes, the second perishes. 50%/50%
		random_neighbor_province = { SD_refugees_effect = { ref = 1 } }
		change_variable = { PS_upp_sieg = 1.0 } change_variable = { PS_upp_exp = 1.0 } # statistics
	}
	if = { 	# now if still has 2 -> escapes
		limit = { check_variable = { SD_u_lost = 1 } base_tax = 2 }
		subtract_variable = { SD_u_lost = 1 } add_base_tax = -1
		random_neighbor_province = { SD_refugees_effect = { ref = 1 } }
		change_variable = { PS_upp_exp = 1.0 }
	}
	if = { 	# last one also is lost! back to zero
		limit = { check_variable = { SD_u_lost = 1 } base_tax = 1 }
		subtract_variable = { SD_u_lost = 1 } set_base_tax = 0
		change_variable = { PS_upp_sieg = 1.0 }
	}
	set_variable = { which = SD_u_lost value = 0 }


}

SD_refugees_effect = {
	# the people itself
	change_variable = { SD_refugees = $ref$ }

	# track the origin province
	set_variable = { which = prov_id which = PREV }
	set_variable = { which = SD_ref_origin which = prov_id }	# to let them back, if so
	set_variable = { which = prov_id which = prov_id_base } 	# back to itself

	# flag for the event
	set_province_flag = SD_new_refugees
}
SD_slave_prov_modifiers = {
	# Province modifier effect
	add_province_modifier = { name = SD_enslavement_here duration = $days$ }
	every_neighbor_province = {
		limit = { controlled_by = event_target:SD_besieged_owner }
		add_province_modifier = { name = SD_enslv_there_hostile duration = $days$ }
	}
	every_neighbor_province = {
		limit = { controlled_by = ROOT }
		add_province_modifier = { name = SD_enslv_there_friend duration = $days$ }
	}
	ROOT = { set_country_flag = SD_recent_captives }
}

collateral_damage_eff = {	# repair value at risk: 75% of build value. Size is the increased budget: 2x means hitting twice as much buildings

	multiply_variable = { SD_colat = $size$ } multiply_variable = { SD_colat = 0.01 }
	while = {
		limit = { check_variable = { SD_colat = 10 } }

		random_list = {
			10 = { trigger_switch = { on_trigger = has_building
				mathematician_academy = { 	subtract_variable = { SD_colat = 1125 } 	col_1_$hd$ = { val = 1125 out = mathematician_academy } }
				philosophers_academy = { 	subtract_variable = { SD_colat = 1125 } 	col_1_$hd$ = { val = 1125 out = philosophers_academy } }
				military_academy = { 		subtract_variable = { SD_colat = 1125 } 	col_1_$hd$ = { val = 1125 out = military_academy } }
				great_library = { subtract_variable = { SD_colat = 1125 } 	col_2_$hd$ = { val = 1125 out = great_library new = library } }
				# He he, Library of Alexandria goes brrrr
				library = { subtract_variable = { SD_colat = 375 } 	col_1_$hd$ = { val = 375 out = library } }
			} }
			10 = { trigger_switch = { on_trigger = has_building
				small_bath = { 	subtract_variable = { SD_colat = 150 } 	col_1_$hd$ = { val = 150 out = small_bath } }
				big_bath = { 	subtract_variable = { SD_colat = 300 } 	col_2_$hd$ = { val = 300 out = big_bath new = small_bath } }
			} }
			10 = { trigger_switch = { on_trigger = has_building
				embassy = { 			subtract_variable = { SD_colat = 375 } col_1_$hd$ = { val = 375 out = embassy } }
				diplomats_quarter = { 	subtract_variable = { SD_colat = 1125 }
				col_2_$hd$ = { val = 1125 out = diplomats_quarter new = embassy } }
			} }
			10 = { trigger_switch = { on_trigger = has_building
				small_townhall = { 		subtract_variable = { SD_colat = 300 } col_1_$hd$ = { val = 300 out = small_townhall } }
				big_townhall = { 		subtract_variable = { SD_colat = 375 }
				col_2_$hd$ = { val = 375 out = big_townhall new = small_townhall } }
				government_palace = { 	subtract_variable = { SD_colat = 600 }
				col_2_$hd$ = { val = 600 out = government_palace new = big_townhall } }
				government_district = { subtract_variable = { SD_colat = 750 }
				col_2_$hd$ = { val = 750 out = government_district new = government_palace } }
			} }
			10 = { trigger_switch = { on_trigger = has_building
				small_grain_depot = { 	subtract_variable = { SD_colat = 225 } col_1_$hd$ = { val = 225 out = small_grain_depot } }
				big_grain_depot = { 	subtract_variable = { SD_colat = 450 }
				col_2_$hd$ = { val = 450 out = big_grain_depot new = small_grain_depot } }
			} }
			10 = { trigger_switch = { on_trigger = has_building
				tiny_marketplace = { 	subtract_variable = { SD_colat = 150 } col_1_$hd$ = { val = 150 out = tiny_marketplace } }
				marketplace = { 	subtract_variable = { SD_colat = 225 } col_2_$hd$ = { val = 225 out = marketplace new = tiny_marketplace } }
				trade_depot = { 	subtract_variable = { SD_colat = 300 } col_2_$hd$ = { val = 300 out = trade_depot new = marketplace } }
			} }
			10 = { trigger_switch = { on_trigger = has_building
				small_harbor = { 	subtract_variable = { SD_colat = 150 } col_1_$hd$ = { val = 150 out = small_harbor } }
				big_harbor = { 		subtract_variable = { SD_colat = 300 } col_2_$hd$ = { val = 300 out = big_harbor new = small_harbor } }
				harbor_district = { subtract_variable = { SD_colat = 450 } col_2_$hd$ = { val = 450 out = harbor_district new = big_harbor } }
			} }
			10 = { trigger_switch = { on_trigger = has_building
				small_army_camp = { 			subtract_variable = { SD_colat = 150 } col_1_$hd$ = { val = 150 out = small_army_camp } }
				small_military_settlement = { 	subtract_variable = { SD_colat = 260 }
				col_2_$hd$ = { val = 260 out = small_military_settlement new = small_army_camp } }
				big_military_settlement = { 	subtract_variable = { SD_colat = 375 }
				col_2_$hd$ = { val = 375 out = big_military_settlement new = small_military_settlement } }
			} }
		}
			10 = { trigger_switch = { on_trigger = has_building
				cottage = { 	subtract_variable = { SD_colat = 187 } col_1_$hd$ = { val = 187 out = cottage } }
				workshop = { 	subtract_variable = { SD_colat = 300 }
				col_2_$hd$ = { val = 300 out = workshop new = cottage } }
				new_manufactory = { 				subtract_variable = { SD_colat = 412 }
				col_2_$hd$ = { val = 412 out = new_manufactory new = workshop } }

				cottage = { 		subtract_variable = { SD_colat = 187 } col_1_$hd$ = { val = 187 out = cottage } }
				workshop = { 	subtract_variable = { SD_colat = 300 } col_2_$hd$ = { val = 300 out = workshop new = cottage } }
				new_manufactory = { subtract_variable = { SD_colat = 412 } col_2_$hd$ = { val = 412 out = new_manufactory new = workshop } }

				cottage = { 			subtract_variable = { SD_colat = 187 } col_1_$hd$ = { val = 187 out = cottage } }
				workshop = { 		subtract_variable = { SD_colat = 300 } col_2_$hd$ = { val = 300 out = workshop new = cottage } }
				new_manufactory = { 		subtract_variable = { SD_colat = 412 } col_2_$hd$ = { val = 412 out = new_manufactory new = workshop } }
			} }
			10 = { trigger_switch = { on_trigger = has_building
				small_shipyard = { 	subtract_variable = { SD_colat = 187 } col_1_$hd$ = { val = 187 out = small_shipyard } }
				big_shipyard = { 	subtract_variable = { SD_colat = 375 } col_2_$hd$ = { val = 375 out = big_shipyard new = small_shipyard } }
			} }
			10 = { trigger_switch = { on_trigger = has_building
				military_monument = { subtract_variable = { SD_colat = 750 } col_1_$hd$ = { val = 750 out = military_monument } }
				naval_monument = { 	subtract_variable = { SD_colat = 750 } col_1_$hd$ = { val = 750 out = naval_monument } }
				imperial_palace = { subtract_variable = { SD_colat = 1500 } col_1_$hd$ = { val = 1500 out = imperial_palace } }
				palace_garden = { 	subtract_variable = { SD_colat = 1500 } col_1_$hd$ = { val = 1500 out = palace_garden } }
			} }
			10 = { trigger_switch = { on_trigger = has_building
				taxman = { 			subtract_variable = { SD_colat = 150 } col_1_$hd$ = { val = 150 out = taxman } }
				tax_collector = { 	subtract_variable = { SD_colat = 300 } col_2_$hd$ = { val = 300 out = tax_collector new = taxman } }
			} }
			10 = { trigger_switch = { on_trigger = has_building
				shrine = { 			subtract_variable = { SD_colat = 150 } col_1_$hd$ = { val = 150 out = shrine } }
				small_temple = { 	subtract_variable = { SD_colat = 225 } col_2_$hd$ = { val = 225 out = small_temple new = shrine } }
				great_temple = { 	subtract_variable = { SD_colat = 300 } col_2_$hd$ = { val = 300 out = great_temple new = small_temple } }
			} }
			10 = { trigger_switch = { on_trigger = has_building
				small_theater = { 	subtract_variable = { SD_colat = 225 } col_1_$hd$ = { val = 225 out = small_theater } }
				big_theater = { 	subtract_variable = { SD_colat = 375 } col_2_$hd$ = { val = 375 out = big_theater new = small_theater } }
				great_theater = { 	subtract_variable = { SD_colat = 525 } col_2_$hd$ = { val = 525 out = great_theater new = big_theater } }
				huge_theater = { 	subtract_variable = { SD_colat = 750 } col_2_$hd$ = { val = 750 out = huge_theater new = great_theater } }
			} }
			10 = { trigger_switch = { on_trigger = has_building
				gravel_road = { 	subtract_variable = { SD_colat = 187 } col_1_$hd$ = { val = 187 out = gravel_road } }
				paved_road = { 		subtract_variable = { SD_colat = 300 } col_2_$hd$ = { val = 300 out = paved_road new = gravel_road } }
				imperial_road = { 	subtract_variable = { SD_colat = 375 } col_2_$hd$ = { val = 375 out = imperial_road new = paved_road } }
			} }
			10 = { trigger_switch = { on_trigger = has_building 			# Last building, should be the last to survive.
				herbalist = { 	subtract_variable = { SD_colat = 150 } col_1_$hd$ = { val = 150 out = herbalist } }
				medicus = { 	subtract_variable = { SD_colat = 225 } col_2_$hd$ = { val = 225 out = medicus new = herbalist } }
				hospital = { 	subtract_variable = { SD_colat = 300 } col_2_$hd$ = { val = 300 out = hospital new = medicus } }
			} }



		}
	}
}

col_1_10 = { random = { chance = 10	remove_building = $out$ set_province_flag = $out$_lost change_variable = { SD_blds = $val$ } } }
col_2_10 = { random = { chance = 10	remove_building = $out$ add_building = $new$ set_province_flag = $out$_lost change_variable = { SD_blds = $val$ } } }
col_1_20 = { random = { chance = 20	remove_building = $out$ set_province_flag = $out$_lost change_variable = { SD_blds = $val$ } } }
col_2_20 = { random = { chance = 20	remove_building = $out$ add_building = $new$ set_province_flag = $out$_lost change_variable = { SD_blds = $val$ } } }
col_1_40 = { random = { chance = 40	remove_building = $out$ set_province_flag = $out$_lost change_variable = { SD_blds = $val$ } } }
col_2_40 = { random = { chance = 40	remove_building = $out$ add_building = $new$ set_province_flag = $out$_lost change_variable = { SD_blds = $val$ } } }
col_1_60 = { random = { chance = 60	remove_building = $out$ set_province_flag = $out$_lost change_variable = { SD_blds = $val$ } } }
col_2_60 = { random = { chance = 60	remove_building = $out$ add_building = $new$ set_province_flag = $out$_lost change_variable = { SD_blds = $val$ } } }
col_1_80 = { random = { chance = 80	remove_building = $out$ set_province_flag = $out$_lost change_variable = { SD_blds = $val$ } } }
col_2_80 = { random = { chance = 80	remove_building = $out$ add_building = $new$ set_province_flag = $out$_lost change_variable = { SD_blds = $val$ } } }
col_1_100 = { remove_building = $out$ set_province_flag = $out$_lost change_variable = { SD_blds = $val$ } }
col_2_100 = { remove_building = $out$ add_building = $new$ set_province_flag = $out$_lost change_variable = { SD_blds = $val$ } }


SD_find_total_loot = {	# Possible loot: 33% of full building value. Repair value: 75% of full building value
	# City walls are not destroyed
	trigger_switch = {
		on_trigger = has_building
		mathematician_academy = { change_variable = { SD_loot = 500 } }
		philosophers_academy = { change_variable = { SD_loot = 500 } }
		military_academy = { 	change_variable = { SD_loot = 500 } }
		great_library = { 		change_variable = { SD_loot = 500 } }
		library = { 			change_variable = { SD_loot = 166 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_bath = { 		change_variable = { SD_loot = 66 } }
		big_bath = { 		change_variable = { SD_loot = 133 } }
	}
	trigger_switch = {
		on_trigger = has_building
		embassy = { 			change_variable = { SD_loot = 166 } }
		diplomats_quarter = { 	change_variable = { SD_loot = 500 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_townhall = { 		change_variable = { SD_loot = 133 } }
		big_townhall = { 		change_variable = { SD_loot = 166 } }
		government_palace = { 	change_variable = { SD_loot = 233 } }
		government_district = { change_variable = { SD_loot = 333 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_grain_depot = { change_variable = { SD_loot = 100 } }
		big_grain_depot = { change_variable = { SD_loot = 200 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_harbor = { 	change_variable = { SD_loot = 66 } }
		big_harbor = { 		change_variable = { SD_loot = 133 } }
		harbor_district = { change_variable = { SD_loot = 200 } }
	}
	trigger_switch = {
		on_trigger = has_building
		tiny_marketplace = { 	change_variable = { SD_loot = 66 } }
		marketplace = { 	change_variable = { SD_loot = 100 } }
		trade_depot = { 	change_variable = { SD_loot = 133 } }
	}
	trigger_switch = {
		on_trigger = has_building
		herbalist = { 	change_variable = { SD_loot = 66 } }
		medicus = { 	change_variable = { SD_loot = 100 } }
		hospital = { 	change_variable = { SD_loot = 133 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_army_camp = { 			change_variable = { SD_loot = 66 } }
		small_military_settlement = { 	change_variable = { SD_loot = 116 } }
		big_military_settlement = { 	change_variable = { SD_loot = 166 } }
	}
	trigger_switch = {
		on_trigger = has_building
		cottage = { 	change_variable = { SD_loot = 83 } }
		workshop = { 	change_variable = { SD_loot = 133 } }
		new_manufactory = { 				change_variable = { SD_loot = 183 } }

		cottage = { 		change_variable = { SD_loot = 83 } }
		workshop = { 	change_variable = { SD_loot = 133 } }
		new_manufactory = { change_variable = { SD_loot = 183 } }

		cottage = { 			change_variable = { SD_loot = 83 } }
		workshop = { 		change_variable = { SD_loot = 133 } }
		new_manufactory = { 		change_variable = { SD_loot = 183 } }
	}
	trigger_switch = {
		on_trigger = has_building
		gravel_road = { 	change_variable = { SD_loot = 83 } }
		paved_road = { 		change_variable = { SD_loot = 133 } }
		imperial_road = { 	change_variable = { SD_loot = 166 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_shipyard = { 	change_variable = { SD_loot = 83 } }
		big_shipyard = { 	change_variable = { SD_loot = 166 } }
	}
	trigger_switch = {
		on_trigger = has_building
		military_monument = { change_variable = { SD_loot = 500 } }
		naval_monument = { 	change_variable = { SD_loot = 500 } }
		imperial_palace = { change_variable = { SD_loot = 666 } }
		palace_garden = { 	change_variable = { SD_loot = 666 } }
	}
	trigger_switch = {
		on_trigger = has_building
		taxman = { 			change_variable = { SD_loot = 66 } }
		tax_collector = { 	change_variable = { SD_loot = 133 } }
	}
	trigger_switch = {
		on_trigger = has_building
		shrine = { 			change_variable = { SD_loot = 66 } }
		small_temple = { 	change_variable = { SD_loot = 100 } }
		great_temple = { 	change_variable = { SD_loot = 133 } }
	}
	trigger_switch = {
		on_trigger = has_building
		small_theater = { 	change_variable = { SD_loot = 100 } }
		big_theater = { 	change_variable = { SD_loot = 166 } }
		great_theater = { 	change_variable = { SD_loot = 233 } }
		huge_theater = { 	change_variable = { SD_loot = 333 } }
	}
	trigger_switch = {
		on_trigger = has_building
		farming_settlement = { 	change_variable = { SD_loot = 200 } }
		winery = { 				change_variable = { SD_loot = 200 } }
		shepherds = { 			change_variable = { SD_loot = 200 } }
		apiary = { 				change_variable = { SD_loot = 200 } }
		weavers = { 			change_variable = { SD_loot = 200 } }
		fishermen_huts = { 		change_variable = { SD_loot = 200 } }
		tannery = { 			change_variable = { SD_loot = 200 } }
		salt_gatherers = { 		change_variable = { SD_loot = 200 } }
		miners_camp = { 		change_variable = { SD_loot = 200 } }
		pottery = { 			change_variable = { SD_loot = 200 } }
		glassmaker = { 			change_variable = { SD_loot = 200 } }
		tar_pit = { 			change_variable = { SD_loot = 200 } }
		blacksmith = { 			change_variable = { SD_loot = 200 } }
		horsebreeder = { 		change_variable = { SD_loot = 200 } }
		lumberjack = { 			change_variable = { SD_loot = 200 } }
		dyer = { 				change_variable = { SD_loot = 200 } }


	}
}

SS_repair_trade_roads_harbor = {	# Repair for 75% of their cost
	trigger_switch = {
		on_trigger = has_province_flag
		tiny_marketplace_lost = { 	clr_province_flag = tiny_marketplace_lost 	add_building = tiny_marketplace  ROOT = { add_treasury = -150 } }
		marketplace_lost = { 	clr_province_flag = marketplace_lost 	add_building = marketplace ROOT = { add_treasury = -225 } }
		trade_depot_lost = { 	clr_province_flag = trade_depot_lost 	add_building = trade_depot  ROOT = { add_treasury = -300 } }
	}
	trigger_switch = {
		on_trigger = has_province_flag
		gravel_road_lost = { 	clr_province_flag = gravel_road_lost 	add_building = gravel_road 	 ROOT = { add_treasury = -187 } }
		paved_road_lost = { 	clr_province_flag = paved_road_lost 	add_building = paved_road 	 ROOT = { add_treasury = -300 } }
		imperial_road_lost = { 	clr_province_flag = imperial_road_lost 	add_building = imperial_road ROOT = { add_treasury = -375 } }
	}
	trigger_switch = {
		on_trigger = has_province_flag
		small_harbor_lost = { 	clr_province_flag = small_harbor_lost 	add_building = small_harbor ROOT = { add_treasury = -150 } }
		big_harbor_lost = { 	clr_province_flag = big_harbor_lost 	add_building = big_harbor ROOT = { add_treasury = -300 } }
		harbor_district_lost = { clr_province_flag = harbor_district_lost add_building = harbor_district ROOT = { add_treasury = -450 } }
	}

}

SS_repair_temples = {
	trigger_switch = {
		on_trigger = has_province_flag
		shrine_lost = { 		clr_province_flag = shrine_lost 		add_building = shrine 		ROOT = { add_treasury = -150 } }
		small_temple_lost = { 	clr_province_flag = small_temple_lost 	add_building = small_temple ROOT = { add_treasury = -225 } }
		great_temple_lost = { 	clr_province_flag = great_temple_lost 	add_building = great_temple ROOT = { add_treasury = -300 } }
	}
}

SS_repair_health_industry = {
	trigger_switch = {
		on_trigger = has_province_flag
		small_grain_depot_lost = { 	clr_province_flag = small_grain_depot_lost 	add_building = small_grain_depot 	ROOT = { add_treasury = -225 } }
		big_grain_depot_lost = { 	clr_province_flag = big_grain_depot_lost 	add_building = big_grain_depot 		ROOT = { add_treasury = -450 } }
	}

	trigger_switch = {
		on_trigger = has_province_flag
		cottage_lost = { 			clr_province_flag = cottage_lost 			add_building = cottage 			ROOT = { add_treasury = -80 } }
		workshop_lost = { 			clr_province_flag = workshop_lost 			add_building = workshop 		ROOT = { add_treasury = -200 } }
		new_manufactory_lost = { 	clr_province_flag = new_manufactory_lost 	add_building = new_manufactory 	ROOT = { add_treasury = -400 } }
		factory_lost = { 			clr_province_flag = factory_lost 			add_building = factory 			ROOT = { add_treasury = -800 } }
	}

	trigger_switch = {
		on_trigger = has_province_flag
		herbalist_lost = { 	clr_province_flag = herbalist_lost 	add_building = herbalist 	ROOT = { add_treasury = -150 } }
		medicus_lost = { 	clr_province_flag = medicus_lost 	add_building = medicus 		ROOT = { add_treasury = -225 } }
		hospital_lost = { 	clr_province_flag = hospital_lost 	add_building = hospital 	ROOT = { add_treasury = -300 } }
	}

}

SS_repair_military_shipyards = {
	if = {
		limit = { has_province_flag = small_conscription_center_lost }
		clr_province_flag = small_conscription_center_lost add_building = small_conscription_center ROOT = { add_treasury = -187 }
	}
	trigger_switch = {
		on_trigger = has_province_flag
		small_army_camp_lost = { 			clr_province_flag = small_army_camp_lost 			add_building = small_army_camp ROOT = { add_treasury = -150 } }
		small_military_settlement_lost = { 	clr_province_flag = small_military_settlement_lost 	add_building = small_military_settlement ROOT = { add_treasury = -260 } }
		big_military_settlement_lost = { 	clr_province_flag = big_military_settlement_lost 	add_building = big_military_settlement ROOT = { add_treasury = -375 } }

	}
	trigger_switch = {
		on_trigger = has_province_flag
		small_shipyard_lost = { clr_province_flag = small_shipyard_lost add_building = small_shipyard 	ROOT = { add_treasury = -187 } }
		big_shipyard_lost = { 	clr_province_flag = big_shipyard_lost 	add_building = big_shipyard 	ROOT = { add_treasury = -375 } }

	}

}

SS_repair_government = {
	trigger_switch = {
		on_trigger = has_province_flag
		small_townhall_lost = { 		clr_province_flag = small_townhall_lost 	add_building = small_townhall 		ROOT = { add_treasury = -300 } }
		big_townhall_lost = { 			clr_province_flag = big_townhall_lost 		add_building = big_townhall 		ROOT = { add_treasury = -375 } }
		government_palace_lost = { 		clr_province_flag = government_palace_lost 	add_building = government_palace 	ROOT = { add_treasury = -600 } }
		government_district_lost = { 	clr_province_flag = government_district_lost add_building = government_district ROOT = { add_treasury = -750 } }
	}
	trigger_switch = {
		on_trigger = has_province_flag
		taxman_lost = { clr_province_flag = taxman_lost add_building = taxman 						ROOT = { add_treasury = -150 } }
		tax_collector_lost = { clr_province_flag = tax_collector_lost add_building = tax_collector 	ROOT = { add_treasury = -300 } }
	}
	trigger_switch = {
		on_trigger = has_province_flag
		embassy_lost = { clr_province_flag = embassy_lost add_building = embassy 								ROOT = { add_treasury = -375 } }
		diplomats_quarter_lost = { clr_province_flag = diplomats_quarter_lost add_building = diplomats_quarter 	ROOT = { add_treasury = -750 } }
	}
}
SS_repair_leisure_education = {
	if = {
		limit = { has_province_flag = military_monument_lost }
		clr_province_flag = military_monument_lost add_building = military_monument ROOT = { add_treasury = -750 }
	}
	if = {
		limit = { has_province_flag = naval_monument_lost }
		clr_province_flag = naval_monument_lost add_building = naval_monument ROOT = { add_treasury = -750 }
	}
	if = {
		limit = { has_province_flag = imperial_palace_lost }
		clr_province_flag = imperial_palace_lost add_building = imperial_palace ROOT = { add_treasury = -1500 }
	}
	if = {
		limit = { has_province_flag = palace_garden_lost }
		clr_province_flag = palace_garden_lost add_building = palace_garden ROOT = { add_treasury = -1500 }
	}
	trigger_switch = {
		on_trigger = has_province_flag
		small_theater_lost = { 	clr_province_flag = small_theater_lost 	add_building = small_theater 	ROOT = { add_treasury = -225 } }
		big_theater_lost = { 	clr_province_flag = big_theater_lost 	add_building = big_theater 		ROOT = { add_treasury = -375 } }
		great_theater_lost = { 	clr_province_flag = great_theater_lost 	add_building = great_theater 	ROOT = { add_treasury = -525 } }
		huge_theater_lost = { 	clr_province_flag = huge_theater_lost 	add_building = huge_theater 	ROOT = { add_treasury = -750 } }
	}
	trigger_switch = {
		on_trigger = has_province_flag
		small_bath_lost = { clr_province_flag = small_bath_lost add_building = small_bath ROOT = { add_treasury = -150 } }
		big_bath_lost = { clr_province_flag = big_bath_lost add_building = big_bath ROOT = { add_treasury = -300 } }

	}
	trigger_switch = {
		on_trigger = has_province_flag
		mathematician_academy_lost = { 	clr_province_flag = mathematician_academy_lost add_building = mathematician_academy ROOT = { add_treasury = -1000 } }
		philosophers_academy_lost = { 	clr_province_flag = philosophers_academy_lost add_building = philosophers_academy ROOT = { add_treasury = -1000 } }
		military_academy_lost = { 		clr_province_flag = military_academy_lost add_building = military_academy ROOT = { add_treasury = -1000 } }
		great_library_lost = { 			clr_province_flag = great_library_lost 	add_building = great_library ROOT = { add_treasury = -1000 } }
		library_lost = { 				clr_province_flag = library_lost 		add_building = library ROOT = { add_treasury = -250 } }
	}

}



SS_find_existing_ruins = {
	if = {
		limit = {
			OR = {
				has_province_flag = small_bath_lost				has_province_flag = big_bath_lost		has_province_flag = mathematician_academy_lost
				has_province_flag = philosophers_academy_lost	has_province_flag = military_academy_lost	has_province_flag = great_library_lost
				has_province_flag = library_lost 				has_province_flag = embassy_lost			has_province_flag = diplomats_quarter_lost
				has_province_flag = small_townhall_lost			has_province_flag = big_townhall_lost		has_province_flag = government_palace_lost
				has_province_flag = government_district_lost	has_province_flag = small_grain_depot_lost	has_province_flag = big_grain_depot_lost
				has_province_flag = tiny_marketplace_lost			has_province_flag = marketplace_lost		has_province_flag = trade_depot_lost
				has_province_flag = small_harbor_lost			has_province_flag = big_harbor_lost			has_province_flag = harbor_district_lost
				has_province_flag = small_army_camp_lost			has_province_flag = small_military_settlement_lost
				has_province_flag = big_military_settlement_lost	has_province_flag = small_conscription_center_lost
				has_province_flag = cottage_lost has_province_flag = workshop_lost has_province_flag = new_manufactory_lost
				has_province_flag = craftsman_lost 				has_province_flag = small_workshop_lost 	has_province_flag = artisan_district_lost
				has_province_flag = quarry_lost					has_province_flag = small_mine_lost			has_province_flag = big_mine_lost
				has_province_flag = small_shipyard_lost			has_province_flag = big_shipyard_lost
				has_province_flag = military_monument_lost		has_province_flag = naval_monument_lost		has_province_flag = imperial_palace_lost
				has_province_flag = palace_garden_lost			has_province_flag = taxman_lost				has_province_flag = tax_collector_lost
				has_province_flag = shrine_lost					has_province_flag = small_temple_lost		has_province_flag = great_temple_lost
				has_province_flag = small_theater_lost			has_province_flag = big_theater_lost		has_province_flag = great_theater_lost
				has_province_flag = huge_theater_lost			has_province_flag = gravel_road_lost		has_province_flag = paved_road_lost
				has_province_flag = imperial_road_lost			has_province_flag = herbalist_lost			has_province_flag = medicus_lost
				has_province_flag = hospital_lost
			}
		}
		add_building = building_ruins
	}

}

SS_clear_land_cost = {
	while = {
		limit = {
			OR = {
				has_province_flag = small_bath_lost				has_province_flag = big_bath_lost		has_province_flag = mathematician_academy_lost
				has_province_flag = philosophers_academy_lost	has_province_flag = military_academy_lost	has_province_flag = great_library_lost
				has_province_flag = library_lost 				has_province_flag = embassy_lost			has_province_flag = diplomats_quarter_lost
				has_province_flag = small_townhall_lost			has_province_flag = big_townhall_lost		has_province_flag = government_palace_lost
				has_province_flag = government_district_lost	has_province_flag = small_grain_depot_lost	has_province_flag = big_grain_depot_lost
				has_province_flag = tiny_marketplace_lost			has_province_flag = marketplace_lost		has_province_flag = trade_depot_lost
				has_province_flag = small_harbor_lost			has_province_flag = big_harbor_lost			has_province_flag = harbor_district_lost
				has_province_flag = small_army_camp_lost			has_province_flag = small_military_settlement_lost
				has_province_flag = big_military_settlement_lost	has_province_flag = small_conscription_center_lost
				has_province_flag = cottage_lost has_province_flag = workshop_lost has_province_flag = new_manufactory_lost
				has_province_flag = craftsman_lost 				has_province_flag = small_workshop_lost 	has_province_flag = artisan_district_lost
				has_province_flag = quarry_lost					has_province_flag = small_mine_lost			has_province_flag = big_mine_lost
				has_province_flag = small_shipyard_lost			has_province_flag = big_shipyard_lost
				has_province_flag = military_monument_lost		has_province_flag = naval_monument_lost		has_province_flag = imperial_palace_lost
				has_province_flag = palace_garden_lost			has_province_flag = taxman_lost				has_province_flag = tax_collector_lost
				has_province_flag = shrine_lost					has_province_flag = small_temple_lost		has_province_flag = great_temple_lost
				has_province_flag = small_theater_lost			has_province_flag = big_theater_lost		has_province_flag = great_theater_lost
				has_province_flag = huge_theater_lost			has_province_flag = gravel_road_lost		has_province_flag = paved_road_lost
				has_province_flag = imperial_road_lost			has_province_flag = herbalist_lost			has_province_flag = medicus_lost
				has_province_flag = hospital_lost
			}
		}
		trigger_switch = {
			on_trigger = has_province_flag
			small_bath_lost = { clr_province_flag = small_bath_lost  ROOT = { add_treasury = -10 add_adm_power = -1 } }
			big_bath_lost = { clr_province_flag = big_bath_lost  ROOT = { add_treasury = -20 add_adm_power = -2 } }
			mathematician_academy_lost = { clr_province_flag = mathematician_academy_lost  ROOT = { add_treasury = -50 add_adm_power = -5 } }
			philosophers_academy_lost = { clr_province_flag = philosophers_academy_lost  ROOT = { add_treasury = -50 add_adm_power = -5 } }
			military_academy_lost = { clr_province_flag = military_academy_lost  ROOT = { add_treasury = -50 add_adm_power = -5 } }
			great_library_lost = { clr_province_flag = great_library_lost  ROOT = { add_treasury = -50 add_adm_power = -5 } }
			library_lost = { clr_province_flag = library_lost  ROOT = { add_treasury = -17 add_adm_power = -1 } }
			embassy_lost = { clr_province_flag = embassy_lost  ROOT = { add_treasury = -25 add_adm_power = -2 } }
			diplomats_quarter_lost = { clr_province_flag = diplomats_quarter_lost  ROOT = { add_treasury = -50 add_adm_power = -5 } }
			small_townhall_lost = { clr_province_flag = small_townhall_lost  ROOT = { add_treasury = -20 add_adm_power = -2 } }
			big_townhall_lost = { clr_province_flag = big_townhall_lost  ROOT = { add_treasury = -25 add_adm_power = -2 } }
			government_palace_lost = { clr_province_flag = government_palace_lost  ROOT = { add_treasury = -40 add_adm_power = -4 } }
			government_district_lost = { clr_province_flag = government_district_lost  ROOT = { add_treasury = -50 add_adm_power = -5 } }
			small_grain_depot_lost = { clr_province_flag = small_grain_depot_lost  ROOT = { add_treasury = -15 add_adm_power = -1 } }
			big_grain_depot_lost = { clr_province_flag = big_grain_depot_lost  ROOT = { add_treasury = -30 add_adm_power = -3 } }
			tiny_marketplace_lost = { clr_province_flag = tiny_marketplace_lost  ROOT = { add_treasury = -10 add_adm_power = -1 } }
			marketplace_lost = { clr_province_flag = marketplace_lost  ROOT = { add_treasury = -20 add_adm_power = -2 } }
			trade_depot_lost = { clr_province_flag = trade_depot_lost  ROOT = { add_treasury = -30 add_adm_power = -3 } }
			small_harbor_lost = { clr_province_flag = small_harbor_lost  ROOT = { add_treasury = -10 add_adm_power = -1 } }
			big_harbor_lost = { clr_province_flag = big_harbor_lost  ROOT = { add_treasury = -20 add_adm_power = -2 } }
			harbor_district_lost = { clr_province_flag = harbor_district_lost  ROOT = { add_treasury = -30 add_adm_power = -3 } }
			small_army_camp_lost = { clr_province_flag = small_army_camp_lost  ROOT = { add_treasury = -10 add_adm_power = -1 } }
			small_military_settlement_lost = { clr_province_flag = small_military_settlement_lost  ROOT = { add_treasury = -17 add_adm_power = -1 } }
			big_military_settlement_lost = { clr_province_flag = big_military_settlement_lost  ROOT = { add_treasury = -25 add_adm_power = -2 } }
			small_conscription_center_lost = { clr_province_flag = small_conscription_center_lost  ROOT = { add_treasury = -12 add_adm_power = -1 } }
			cottage_lost = { clr_province_flag = cottage_lost  ROOT = { add_treasury = -12 add_adm_power = -1 } }
			workshop_lost = { clr_province_flag = workshop_lost  ROOT = { add_treasury = -20 add_adm_power = -2 } }
			new_manufactory_lost = { clr_province_flag = new_manufactory_lost  ROOT = { add_treasury = -27 add_adm_power = -2 } }
			craftsman_lost = { clr_province_flag = craftsman_lost  ROOT = { add_treasury = -12 add_adm_power = -1 } }
			small_workshop_lost = { clr_province_flag = small_workshop_lost  ROOT = { add_treasury = -20 add_adm_power = -2 } }
			artisan_district_lost = { clr_province_flag = artisan_district_lost  ROOT = { add_treasury = -27 add_adm_power = -2 } }
			quarry_lost = { clr_province_flag = quarry_lost  ROOT = { add_treasury = -12 add_adm_power = -1 } }
			small_mine_lost = { clr_province_flag = small_mine_lost  ROOT = { add_treasury = -20 add_adm_power = -2 } }
			big_mine_lost = { clr_province_flag = big_mine_lost  ROOT = { add_treasury = -27 add_adm_power = -2 } }
			small_shipyard_lost = { clr_province_flag = small_shipyard_lost  ROOT = { add_treasury = -12 add_adm_power = -1 } }
			big_shipyard_lost = { clr_province_flag = big_shipyard_lost  ROOT = { add_treasury = -25 add_adm_power = -2 } }
			military_monument_lost = { clr_province_flag = military_monument_lost  ROOT = { add_treasury = -50 add_adm_power = -5 } }
			naval_monument_lost = { clr_province_flag = naval_monument_lost  ROOT = { add_treasury = -50 add_adm_power = -5 } }
			imperial_palace_lost = { clr_province_flag = imperial_palace_lost  ROOT = { add_treasury = -100 add_adm_power = -10 } }
			palace_garden_lost = { clr_province_flag = palace_garden_lost  ROOT = { add_treasury = -100 add_adm_power = -10 } }
			taxman_lost = { clr_province_flag = taxman_lost  ROOT = { add_treasury = -10 add_adm_power = -1 } }
			tax_collector_lost = { clr_province_flag = tax_collector_lost  ROOT = { add_treasury = -20 add_adm_power = -2 } }
			shrine_lost = { clr_province_flag = shrine_lost  ROOT = { add_treasury = -10 add_adm_power = -1 } }
			small_temple_lost = { clr_province_flag = small_temple_lost  ROOT = { add_treasury = -15 add_adm_power = -1 } }
			great_temple_lost = { clr_province_flag = great_temple_lost  ROOT = { add_treasury = -20 add_adm_power = -2 } }
			small_theater_lost = { clr_province_flag = small_theater_lost  ROOT = { add_treasury = -15 add_adm_power = -1 } }
			big_theater_lost = { clr_province_flag = big_theater_lost  ROOT = { add_treasury = -25 add_adm_power = -2 } }
			great_theater_lost = { clr_province_flag = great_theater_lost  ROOT = { add_treasury = -35 add_adm_power = -3 } }
			huge_theater_lost = { clr_province_flag = huge_theater_lost  ROOT = { add_treasury = -50 add_adm_power = -5 } }
			gravel_road_lost = { clr_province_flag = gravel_road_lost  ROOT = { add_treasury = -12 add_adm_power = -1 } }
			paved_road_lost = { clr_province_flag = paved_road_lost  ROOT = { add_treasury = -20 add_adm_power = -2 } }
			imperial_road_lost = { clr_province_flag = imperial_road_lost  ROOT = { add_treasury = -25 add_adm_power = -2 } }
			herbalist_lost = { clr_province_flag = herbalist_lost  ROOT = { add_treasury = -10 add_adm_power = -1 } }
			medicus_lost = { clr_province_flag = medicus_lost  ROOT = { add_treasury = -15 add_adm_power = -1 } }
			hospital_lost = { clr_province_flag = hospital_lost  ROOT = { add_treasury = -20 add_adm_power = -2 } }


		}
	}
}

SS_cleanup_old_ruins = {
	if = { limit = { had_province_flag = { flag = small_bath_lost days = 1825 } } clr_province_flag = small_bath_lost }
	if = { limit = { had_province_flag = { flag = big_bath_lost days = 1825 } } clr_province_flag = big_bath_lost }
	if = { limit = { had_province_flag = { flag = mathematician_academy_lost days = 1825 } } clr_province_flag = mathematician_academy_lost }
	if = { limit = { had_province_flag = { flag = philosophers_academy_lost days = 1825 } } clr_province_flag = philosophers_academy_lost }
	if = { limit = { had_province_flag = { flag = military_academy_lost days = 1825 } } clr_province_flag = military_academy_lost }
	if = { limit = { had_province_flag = { flag = great_library_lost days = 1825 } } clr_province_flag = great_library_lost }
	if = { limit = { had_province_flag = { flag = library_lost days = 1825 } } clr_province_flag = library_lost }
	if = { limit = { had_province_flag = { flag = embassy_lost days = 1825 } } clr_province_flag = embassy_lost }
	if = { limit = { had_province_flag = { flag = diplomats_quarter_lost days = 1825 } } clr_province_flag = diplomats_quarter_lost }
	if = { limit = { had_province_flag = { flag = small_townhall_lost days = 1825 } } clr_province_flag = small_townhall_lost }
	if = { limit = { had_province_flag = { flag = big_townhall_lost days = 1825 } } clr_province_flag = big_townhall_lost }
	if = { limit = { had_province_flag = { flag = government_palace_lost days = 1825 } } clr_province_flag = government_palace_lost }
	if = { limit = { had_province_flag = { flag = government_district_lost days = 1825 } } clr_province_flag = government_district_lost }
	if = { limit = { had_province_flag = { flag = small_grain_depot_lost days = 1825 } } clr_province_flag = small_grain_depot_lost }
	if = { limit = { had_province_flag = { flag = big_grain_depot_lost days = 1825 } } clr_province_flag = big_grain_depot_lost }
	if = { limit = { had_province_flag = { flag = tiny_marketplace_lost days = 1825 } } clr_province_flag = tiny_marketplace_lost }
	if = { limit = { had_province_flag = { flag = marketplace_lost days = 1825 } } clr_province_flag = marketplace_lost }
	if = { limit = { had_province_flag = { flag = trade_depot_lost days = 1825 } } clr_province_flag = trade_depot_lost }
	if = { limit = { had_province_flag = { flag = small_harbor_lost days = 1825 } } clr_province_flag = small_harbor_lost }
	if = { limit = { had_province_flag = { flag = big_harbor_lost days = 1825 } } clr_province_flag = big_harbor_lost }
	if = { limit = { had_province_flag = { flag = harbor_district_lost days = 1825 } } clr_province_flag = harbor_district_lost }
	if = { limit = { had_province_flag = { flag = small_army_camp_lost days = 1825 } } clr_province_flag = small_army_camp_lost }
	if = { limit = { had_province_flag = { flag = small_military_settlement_lost days = 1825 } } clr_province_flag = small_military_settlement_lost }
	if = { limit = { had_province_flag = { flag = big_military_settlement_lost days = 1825 } } clr_province_flag = big_military_settlement_lost }
	if = { limit = { had_province_flag = { flag = small_conscription_center_lost days = 1825 } } clr_province_flag = small_conscription_center_lost }
	if = { limit = { had_province_flag = { flag = cottage_lost days = 1825 } } clr_province_flag = cottage_lost }
	if = { limit = { had_province_flag = { flag = workshop_lost days = 1825 } } clr_province_flag = workshop_lost }
	if = { limit = { had_province_flag = { flag = new_manufactory_lost days = 1825 } } clr_province_flag = new_manufactory_lost }
	if = { limit = { had_province_flag = { flag = craftsman_lost days = 1825 } } clr_province_flag = craftsman_lost }
	if = { limit = { had_province_flag = { flag = small_workshop_lost days = 1825 } } clr_province_flag = small_workshop_lost }
	if = { limit = { had_province_flag = { flag = artisan_district_lost days = 1825 } } clr_province_flag = artisan_district_lost }
	if = { limit = { had_province_flag = { flag = quarry_lost days = 1825 } } clr_province_flag = quarry_lost }
	if = { limit = { had_province_flag = { flag = small_mine_lost days = 1825 } } clr_province_flag = small_mine_lost }
	if = { limit = { had_province_flag = { flag = big_mine_lost days = 1825 } } clr_province_flag = big_mine_lost }
	if = { limit = { had_province_flag = { flag = small_shipyard_lost days = 1825 } } clr_province_flag = small_shipyard_lost }
	if = { limit = { had_province_flag = { flag = big_shipyard_lost days = 1825 } } clr_province_flag = big_shipyard_lost }
	if = { limit = { had_province_flag = { flag = military_monument_lost days = 1825 } } clr_province_flag = military_monument_lost }
	if = { limit = { had_province_flag = { flag = naval_monument_lost days = 1825 } } clr_province_flag = naval_monument_lost }
	if = { limit = { had_province_flag = { flag = imperial_palace_lost days = 1825 } } clr_province_flag = imperial_palace_lost }
	if = { limit = { had_province_flag = { flag = palace_garden_lost days = 1825 } } clr_province_flag = palace_garden_lost }
	if = { limit = { had_province_flag = { flag = taxman_lost days = 1825 } } clr_province_flag = taxman_lost }
	if = { limit = { had_province_flag = { flag = tax_collector_lost days = 1825 } } clr_province_flag = tax_collector_lost }
	if = { limit = { had_province_flag = { flag = shrine_lost days = 1825 } } clr_province_flag = shrine_lost }
	if = { limit = { had_province_flag = { flag = small_temple_lost days = 1825 } } clr_province_flag = small_temple_lost }
	if = { limit = { had_province_flag = { flag = great_temple_lost days = 1825 } } clr_province_flag = great_temple_lost }
	if = { limit = { had_province_flag = { flag = small_theater_lost days = 1825 } } clr_province_flag = small_theater_lost }
	if = { limit = { had_province_flag = { flag = big_theater_lost days = 1825 } } clr_province_flag = big_theater_lost }
	if = { limit = { had_province_flag = { flag = great_theater_lost days = 1825 } } clr_province_flag = great_theater_lost }
	if = { limit = { had_province_flag = { flag = huge_theater_lost days = 1825 } } clr_province_flag = huge_theater_lost }
	if = { limit = { had_province_flag = { flag = gravel_road_lost days = 1825 } } clr_province_flag = gravel_road_lost }
	if = { limit = { had_province_flag = { flag = paved_road_lost days = 1825 } } clr_province_flag = paved_road_lost }
	if = { limit = { had_province_flag = { flag = imperial_road_lost days = 1825 } } clr_province_flag = imperial_road_lost }
	if = { limit = { had_province_flag = { flag = herbalist_lost days = 1825 } } clr_province_flag = herbalist_lost }
	if = { limit = { had_province_flag = { flag = medicus_lost days = 1825 } } clr_province_flag = medicus_lost }
	if = { limit = { had_province_flag = { flag = hospital_lost days = 1825 } } clr_province_flag = hospital_lost }


}

SS_store_building_to_flag = {
	if = { limit = { has_building = small_bath } remove_building = small_bath  set_province_flag = small_bath_kept }
	if = { limit = { has_building = big_bath } remove_building = big_bath  set_province_flag = big_bath_kept }
	if = { limit = { has_building = mathematician_academy } remove_building = mathematician_academy  set_province_flag = mathematician_academy_kept }
	if = { limit = { has_building = philosophers_academy } remove_building = philosophers_academy  set_province_flag = philosophers_academy_kept }
	if = { limit = { has_building = military_academy } remove_building = military_academy  set_province_flag = military_academy_kept }
	if = { limit = { has_building = great_library } remove_building = great_library  set_province_flag = great_library_kept }
	if = { limit = { has_building = library } remove_building = library  set_province_flag = library_kept }
	if = { limit = { has_building = embassy } remove_building = embassy  set_province_flag = embassy_kept }
	if = { limit = { has_building = diplomats_quarter } remove_building = diplomats_quarter  set_province_flag = diplomats_quarter_kept }
	if = { limit = { has_building = small_townhall } remove_building = small_townhall  set_province_flag = small_townhall_kept }
	if = { limit = { has_building = big_townhall } remove_building = big_townhall  set_province_flag = big_townhall_kept }
	if = { limit = { has_building = government_palace } remove_building = government_palace  set_province_flag = government_palace_kept }
	if = { limit = { has_building = government_district } remove_building = government_district  set_province_flag = government_district_kept }
	if = { limit = { has_building = small_grain_depot } remove_building = small_grain_depot  set_province_flag = small_grain_depot_kept }
	if = { limit = { has_building = big_grain_depot } remove_building = big_grain_depot  set_province_flag = big_grain_depot_kept }
	if = { limit = { has_building = tiny_marketplace } remove_building = tiny_marketplace  set_province_flag = tiny_marketplace_kept }
	if = { limit = { has_building = marketplace } remove_building = marketplace  set_province_flag = marketplace_kept }
	if = { limit = { has_building = trade_depot } remove_building = trade_depot  set_province_flag = trade_depot_kept }
	if = { limit = { has_building = small_harbor } remove_building = small_harbor  set_province_flag = small_harbor_kept }
	if = { limit = { has_building = big_harbor } remove_building = big_harbor  set_province_flag = big_harbor_kept }
	if = { limit = { has_building = harbor_district } remove_building = harbor_district  set_province_flag = harbor_district_kept }
	if = { limit = { has_building = small_army_camp } remove_building = small_army_camp  set_province_flag = small_army_camp_kept }
	if = { limit = { has_building = small_military_settlement } remove_building = small_military_settlement  set_province_flag = small_military_settlement_kept }
	if = { limit = { has_building = big_military_settlement } remove_building = big_military_settlement  set_province_flag = big_military_settlement_kept }
	if = { limit = { has_building = cottage } remove_building = cottage  set_province_flag = small_water_irrigation_kept }
	if = { limit = { has_building = workshop } remove_building = workshop  set_province_flag = big_water_irrigation_kept }
	if = { limit = { has_building = new_manufactory } remove_building = new_manufactory  set_province_flag = big_estate_kept }
	if = { limit = { has_building = cottage } remove_building = cottage  set_province_flag = craftsman_kept }
	if = { limit = { has_building = workshop } remove_building = workshop  set_province_flag = small_workshop_kept }
	if = { limit = { has_building = new_manufactory } remove_building = new_manufactory  set_province_flag = artisan_district_kept }
	if = { limit = { has_building = cottage } remove_building = cottage  set_province_flag = quarry_kept }
	if = { limit = { has_building = workshop } remove_building = workshop  set_province_flag = small_mine_kept }
	if = { limit = { has_building = new_manufactory } remove_building = new_manufactory  set_province_flag = big_mine_kept }
	if = { limit = { has_building = small_shipyard } remove_building = small_shipyard  set_province_flag = small_shipyard_kept }
	if = { limit = { has_building = big_shipyard } remove_building = big_shipyard  set_province_flag = big_shipyard_kept }
	if = { limit = { has_building = military_monument } remove_building = military_monument  set_province_flag = military_monument_kept }
	if = { limit = { has_building = naval_monument } remove_building = naval_monument  set_province_flag = naval_monument_kept }
	if = { limit = { has_building = imperial_palace } remove_building = imperial_palace  set_province_flag = imperial_palace_kept }
	if = { limit = { has_building = palace_garden } remove_building = palace_garden  set_province_flag = palace_garden_kept }
	if = { limit = { has_building = taxman } remove_building = taxman  set_province_flag = taxman_kept }
	if = { limit = { has_building = tax_collector } remove_building = tax_collector  set_province_flag = tax_collector_kept }
	if = { limit = { has_building = shrine } remove_building = shrine  set_province_flag = shrine_kept }
	if = { limit = { has_building = small_temple } remove_building = small_temple  set_province_flag = small_temple_kept }
	if = { limit = { has_building = great_temple } remove_building = great_temple  set_province_flag = great_temple_kept }
	if = { limit = { has_building = small_theater } remove_building = small_theater  set_province_flag = small_theater_kept }
	if = { limit = { has_building = big_theater } remove_building = big_theater  set_province_flag = big_theater_kept }
	if = { limit = { has_building = great_theater } remove_building = great_theater  set_province_flag = great_theater_kept }
	if = { limit = { has_building = huge_theater } remove_building = huge_theater  set_province_flag = huge_theater_kept }
	if = { limit = { has_building = gravel_road } remove_building = gravel_road  set_province_flag = gravel_road_kept }
	if = { limit = { has_building = paved_road } remove_building = paved_road  set_province_flag = paved_road_kept }
	if = { limit = { has_building = imperial_road } remove_building = imperial_road  set_province_flag = imperial_road_kept }
	if = { limit = { has_building = herbalist } remove_building = herbalist  set_province_flag = herbalist_kept }
	if = { limit = { has_building = medicus } remove_building = medicus  set_province_flag = medicus_kept }
	if = { limit = { has_building = hospital } remove_building = hospital  set_province_flag = hospital_kept }
	if = { limit = { has_building = cattle_flock } remove_building = cattle_flock set_province_flag = cattle_flock_kept }
	if = { limit = { has_building = warrior_tents } remove_building = warrior_tents  set_province_flag = warrior_tents_kept }
	if = { limit = { has_building = horse_breeder } remove_building = horse_breeder  set_province_flag = horse_breeder_kept }
	if = { limit = { has_building = tribal_gathering } remove_building = tribal_gathering  set_province_flag = tribal_gathering_kept }
	if = { limit = { has_building = horsebreeder } remove_building = horsebreeder  set_province_flag = horsebreeder_kept }
	if = { limit = { has_building = goldsmith } remove_building = goldsmith  set_province_flag = goldsmith_kept }
	if = { limit = { has_building = lumberjack } remove_building = lumberjack  set_province_flag = lumberjack_kept }


}




enslave_effect_soft = {
	# Send slaves to besieger
	set_variable = { which = SS_soft_total which = FROM }
	change_variable = { which = slaves which = SS_soft_total }
	set_variable = { which = SS_soft_total value = 0 }

	# Lose pops. Uses the xx lost done in the event, immediate phase
	FROM = {
		set_variable = { which = SS_slaves_taken which = SS_soft_total }	# display in prov modifier
		set_variable = { which = SS_tlost_display which = SS_t_lost }
		set_variable = { which = SS_clost_display which = SS_c_lost }
		set_variable = { which = SS_ulost_display which = SS_u_lost }

		while = {
			limit = { check_variable = { SS_t_lost = 1 } }
			subtract_variable = { SS_t_lost = 1 } add_base_manpower = -1
			change_variable = { PS_rur_slv = 0.4 } change_variable = { PS_rur_sieg = 0.6 }	# slv enslaved; sig perished in siege
		}
		while = {
			limit = { check_variable = { SS_c_lost = 1 } }
			subtract_variable = { SS_c_lost = 1 } add_base_production = -1
			change_variable = { PS_urb_slv = 0.4 } change_variable = { PS_urb_sieg = 0.6 }
		}
		while = {
			limit = { check_variable = { SS_u_lost = 1 } }
			subtract_variable = { SS_u_lost = 1 } add_base_tax = -1
			change_variable = { PS_upp_slv = 0.4 } change_variable = { PS_upp_sieg = 0.6 }
		}

		# Province modifier effect
		add_province_modifier = { name = SS_enslavement_here duration = $days$ }
		every_neighbor_province = {
			limit = { controlled_by = event_target:SD_besieged_owner }
			add_province_modifier = { name = SS_enslv_there_hostile duration = $days$ }
		}
		every_neighbor_province = {
			limit = { controlled_by = ROOT }
			add_province_modifier = { name = SS_enslv_there_friend duration = $days$ }
		}

	}



}

enslave_effect_hard = {
	# Send slaves to besieger
	set_variable = { which = SS_hard_total which = FROM }
	change_variable = { which = slaves which = SS_hard_total }
	set_variable = { which = SS_hard_total value = 0 }

	# Lose pops. Uses the xx lost done in the event, immediate phase
	FROM = {
		set_variable = { which = SS_slaves_taken which = SS_hard_total }	# display in prov modifier
		set_variable = { which = SS_tlost_display which = SS_t_lost }
		set_variable = { which = SS_clost_display which = SS_c_lost }
		set_variable = { which = SS_ulost_display which = SS_u_lost }

		while = {
			limit = { check_variable = { SS_t_lost = 1 } }
			subtract_variable = { SS_t_lost = 1 } add_base_manpower = -1
			change_variable = { PS_rur_slv = 0.8 } change_variable = { PS_rur_sieg = 0.2 }	# slv enslaved; sig perished in siege
			change_variable = { PS_sieg_lost = 1 }
		}
		while = {
			limit = { check_variable = { SS_c_lost = 1 } }
			subtract_variable = { SS_c_lost = 1 } add_base_production = -1
			change_variable = { PS_urb_slv = 0.8 } change_variable = { PS_urb_sieg = 0.2 } change_variable = { PS_sieg_lost = 1 }
		}
		while = {
			limit = { check_variable = { SS_u_lost = 1 } }
			subtract_variable = { SS_u_lost = 1 } add_base_tax = -1
			change_variable = { PS_upp_slv = 0.8 } change_variable = { PS_upp_sieg = 0.2 } change_variable = { PS_sieg_lost = 1 }
		}

		# Province modifier effect
		add_province_modifier = { name = SS_enslavement_here duration = $days$ }
		every_neighbor_province = {
			limit = { controlled_by = event_target:SD_besieged_owner }
			add_province_modifier = { name = SS_enslv_there_hostile duration = $days$ }
		}
		every_neighbor_province = {
			limit = { controlled_by = ROOT }
			add_province_modifier = { name = SS_enslv_there_friend duration = $days$ }
		}

	}

}

enslave_delenda_effect = {
	# Define everyone (all but the 1 pop left). Recalculates amount lost, the event desc will be different

	FROM = {

		set_variable = { which = SS_t_lost which = SS_t_base } subtract_variable = { SS_t_lost = 1 }
		set_variable = { which = SS_c_lost which = SS_c_base } subtract_variable = { SS_c_lost = 1 }
		set_variable = { which = SS_u_lost which = SS_u_base } subtract_variable = { SS_u_lost = 1 }

		set_variable = { which = SS_tlost_display which = SS_t_lost }
		set_variable = { which = SS_clost_display which = SS_c_lost }
		set_variable = { which = SS_ulost_display which = SS_u_lost }

		set_variable = { which = SS_delenda_total which = SS_t_lost } 		change_variable = { which = SS_delenda_total which = SS_c_lost }
		change_variable = { which = SS_delenda_total which = SS_u_lost }	multiply_variable = { SS_delenda_total = 2 }
		# yes, only 20%. Carthago 146 bc had 450k killed and 50k enslaved, so 20% is even high...

		set_variable = { which = SS_slaves_taken which = SS_delenda_total }	# display in prov modifier

		while = {
			limit = { check_variable = { SS_t_lost = 0.9 } }
			subtract_variable = { SS_t_lost = 1 } add_base_manpower = -1
			change_variable = { PS_rur_slv = 0.2 } change_variable = { PS_rur_sieg = 0.8 }	# slv enslaved; sig perished in siege
		}
		while = {
			limit = { check_variable = { SS_c_lost = 0.9 } }
			subtract_variable = { SS_c_lost = 1 } add_base_production = -1
			change_variable = { PS_urb_slv = 0.2 } change_variable = { PS_urb_sieg = 0.8 }	# slv enslaved; sig perished in siege
		}
		while = {
			limit = { check_variable = { SS_u_lost = 0.9 } }
			subtract_variable = { SS_u_lost = 1 } add_base_tax = -1
			change_variable = { PS_upp_slv = 0.2 } change_variable = { PS_upp_sieg = 0.8 }	# slv enslaved; sig perished in siege
		}




		# Province modifier effect
		add_province_modifier = { name = SS_enslavement_here duration = $days$ }
		every_neighbor_province = {
			limit = { OR = { owned_by = event_target:SD_besieged_owner controlled_by = event_target:SD_besieged_owner } }
			add_province_modifier = { name = SS_enslv_there_hostile duration = $days$ }
		}
		every_neighbor_province = {
			limit = { OR = { owned_by = ROOT controlled_by = ROOT } }
			add_province_modifier = { name = SS_enslv_there_friend duration = $days$ }
		}

	}

	set_variable = { which = SS_delenda_total which = FROM }
	change_variable = { which = slaves which = SS_delenda_total }
	set_variable = { which = SS_delenda_total value = 0 }

}



