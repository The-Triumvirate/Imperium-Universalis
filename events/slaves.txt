namespace = slaves

########################################################################################
# Slaves Main Event
########################################################################################
country_event = {
	id = slaves.1
	title = "slaves.1.t"
	desc = "slaves.1.d"
	picture = slaves
	is_triggered_only = yes
	
	trigger = {
		#always = no		# always yes, again
		NOT = { has_country_modifier = slavery_abolished }		# If slavery is abolished a different event happens (not until Estate is done)
		check_variable = { slaves = 1 }							# As long as there are slaves; otherwise, we don't need it
		has_estate = estate_slaves #Fallback trigger
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {
			# remove any sort of estate owned land
			change_estate_land_share = {
				estate = estate_slaves
				share = -100
			}
			# Find total income
			export_to_variable = { which = slave_income value = monthly_income }
			multiply_variable  = { slave_income = 60 }		# monthly to yearly x every 5 years = 12 x 5 = 60
			
			# Total population
			export_to_variable = { which = var_total_pop value = total_development }
			multiply_variable = { var_total_pop = 10 }									# population in thousands, now
			
			
			# Slave population (at country and manufactories)
			set_variable = { which = slaves_in_province value = 0 }		# reset at country level
			every_owned_province = {
				limit = { check_variable = { slaves_in_province = 1 } }	# any province with slaves there
				owner = { change_variable = { which = slaves_in_province which = PREV } }
			}
			set_variable = { which = slave_pop_social which = slaves } 
			change_variable = { which = slave_pop_social which = slaves_in_province }
			
			if = { limit = { NOT = { check_variable = { var_total_pop = 1 } } } set_variable = { which = var_total_pop value = 1 } }
			divide_variable = { which = slave_pop_social which = var_total_pop } # slave percentage
			multiply_variable = { slave_pop_social = 100 }						 # to be in percentage (1 to 100), not units (0,x to 1,0)
			
			export_to_variable = { which = slave_pop_economic value = modifier:slavesmod_productivity }	# repurposed for Slave Productivity
			change_variable = { slave_pop_economic = 1 }
			multiply_variable = { which = slave_pop_economic which = slaves }		# Slaves, not slaves + manufactories. Only "idle" slaves
			divide_variable = { which = slave_pop_economic which = var_total_pop }  # slave percentage
			multiply_variable = { slave_pop_economic = 100 }						# to be in percentage (1 to 100)
			
			# cleanup of previous modifier
			slaves_remove_basic_modifiers = yes
			slaves_remove_complex_modifiers = yes
			
			# Income
			multiply_variable = { which = slave_income which = slave_pop_economic }
			multiply_variable = { slave_income = 0.01 }
			export_to_variable = { which = slave_autonomy value = trigger_value:average_autonomy }
			subtract_variable = { slave_autonomy = 100 } 
			multiply_variable = { slave_autonomy = -0.01 }	# imagine 25%. 25-100 = -75 x -0,01 = 0,75. Ok
			multiply_variable = { which = slave_income which = slave_autonomy }
			export_to_variable = { which = slave_state_income value = modifier:slavesmod_state_income }
			if = { limit = { NOT = { check_variable = { slave_state_income = 0 } } } set_variable = { which = slave_state_income value = 0 } }
			multiply_variable = { which = slave_income which = slave_state_income }
			
			# Let's find where we are (coordinates x and y)
			slaves_find_coordinates = yes
			
			# Demographics
			export_to_variable = { which = slave_gain value = modifier:slavesmod_natality }
			export_to_variable = { which = slave_loss value = modifier:slavesmod_mortality }
			export_to_variable = { which = slave_libratio value = modifier:slavesmod_liberated }
			
			if = {
				limit = { has_estate_privilege = estate_slaves_law_C2 }			# children not added to slaves, but added to liberated
				set_variable = { which = slave_net_growth which = slave_loss }	
				change_variable = { which = slave_libratio which = slave_gain } 
			}
			else = {
				set_variable = { which = slave_net_growth which = slave_gain }
				subtract_variable = { which = slave_net_growth which = slave_loss }
			}
			
			if = { limit = { NOT = { check_variable = { slave_libratio = 0 } } } set_variable = { which = slave_libratio value = 0 } }
			
			set_variable = { which = slaves_change which = slaves } multiply_variable = { which = slaves_change which = slave_net_growth }
			set_variable = { which = slaves_libers which = slaves } multiply_variable = { which = slaves_libers which = slave_libratio }
			multiply_variable = { slaves_change = 5 } multiply_variable = { slaves_libers = 5 } 	# 5 years
			
			# Show variables for display
			set_variable = { which = slaves_tot_display which = slaves } 
			change_variable = { which = slaves_tot_display which = slaves_in_province }
			multiply_variable = { slaves_tot_display = 0.001 }			multiply_variable = { slaves_tot_display = 1000 }	# rounding
			
			set_variable = { which = slaves_oth_disp which = slaves } 
			multiply_variable = { slaves_oth_disp = 0.001 }			 	multiply_variable = { slaves_oth_disp = 1000 }
			
			set_variable = { which = slaves_mnf_display which = slaves_in_province } 
			multiply_variable = { slaves_mnf_display = 0.001 }			multiply_variable = { slaves_mnf_display = 1000 }
			export_to_variable = { which = slave_productivity value = modifier:slavesmod_productivity }		  # for display purposes
			change_variable = { slave_productivity = 1 } multiply_variable = { slave_productivity = 100 } # to be in percentage (1 to 100)
			
			multiply_variable = { slaves_change = 0.001 }	multiply_variable = { slaves_change = 1000 }
			multiply_variable = { slaves_libers = 0.001 }	multiply_variable = { slaves_libers = 1000 }
			
			multiply_variable = { slave_gain = 100 }		multiply_variable = { slave_net_growth = 100 }
			multiply_variable = { slave_loss = 100 }		multiply_variable = { slave_libratio = 100 }
			multiply_variable = { slave_state_income = 100 }
			export_to_variable = { which = var_total_pop value = total_development }
		}
	}
	
	
	option = {
		name = "slaves.1.1"		
		slaves_ratio_create_high = yes				# Adds the slave % modifier, based on coordinates x (social) and y (economic)
		
		hidden_effect = {
			if = { 
				limit = { check_variable = { slave_income = 0.1 } }
				set_variable = { which = cash_income which = slave_income }
				money_income = yes  
			}
			
			# Demographic effect
			change_variable = { which = slaves which = slaves_change }
			
			# Move liberated slaves to a new pool
			change_variable = { which = freedmen_new which = slaves_libers }
			subtract_variable = { which = slaves which = slaves_libers }
			
		}
		custom_tooltip = SLAVES_EVENT_INCOME
	}
	option = {
		name = "slaves.1.2"		
		
		hidden_effect = {
			slaves_ratio_create_high = yes
			if = { 
				limit = { check_variable = { slave_income = 0.1 } }
				set_variable = { which = cash_income which = slave_income }
				money_income = yes  
			}
			
			# Demographic effect
			change_variable = { which = slaves which = slaves_change }
			
			# Move liberated slaves to a new pool
			change_variable = { which = freedmen_new which = slaves_libers }
			subtract_variable = { which = slaves which = slaves_libers }
			
		}
		custom_tooltip = SLAVES_EVENT_NORMAL
		custom_tooltip = SLAVES_EVENT_RATIOS
		custom_tooltip = SLAVES_EVENT_FORMULA
	}
	
	after = {
		set_variable = { which = var_slave_income value = 0 }
		set_variable = { which = slave_income value = 0 }
		set_variable = { which = slaves_change value = 0 }
		set_variable = { which = slaves_libers value = 0 }
		
	}
}
########
#	BELOW HERE, NOT INCLUDED IN THE MOD. SIEGE EVENTS HAVE BEEN MOVED TO "SIEGES" FILE
#
#
#





########################################################################################
# Sack of City
########################################################################################
country_event = {
	id = slaves.2
	title = "slaves.2.t"
	desc = "slaves.2.d"
	picture = looting
	is_triggered_only = yes
	
	trigger = {
		always = no
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "slaves.2.a" # Enslave the City! 
		trigger = { NOT = { has_country_modifier = slavery_abolished } }
		ai_chance = { 
				factor = 50
				modifier = {
					factor = 0.5
						NOT = { mil_power = 50 }
					}
				modifier = {
					factor = 1.5
					FROM = {
						owner = { is_rival = ROOT }
						}
					} 
				modifier = {
					factor = 1.3
						NOT = { check_variable = { which = var_slaves_pop_ratio value = 10 } }
					}
				modifier = {
					factor = 1.2
						NOT = { check_variable = { which = var_slaves_pop_ratio value = 40 } }
					}
				modifier = {
					factor = 1.1
						NOT = { check_variable = { which = var_slaves_pop_ratio value = 60 } }
					}
				modifier = {
					factor = 0.8
								check_variable = { which = var_slaves_pop_ratio value = 75 }
					}
				modifier = {
					factor = 0.6
								check_variable = { which = var_slaves_pop_ratio value = 100 }
					}
				modifier = {
					factor = 0.1
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = 5 } }
						}
					}
				modifier = {
					factor = 0.5
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -25 } }
						}
					}
				modifier = {
					factor = 1.5
						NOT = {
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -190 } }
							}
						}
					}
				}
		########################################################################
			add_mil_power = -50
			change_variable = { which = slaves value = 10000 }
			FROM = {
							destroy_building_50 = yes
							add_base_tax = -1
							add_base_production = -1
							add_province_modifier = {
								name = ongoing_plundering
								duration = 30
							}
					hidden_effect = {
						FROM = {
								add_devastation = 15
								add_province_modifier = {
										name = was_plundered
										duration = 3650
									}
						}
					}
			}
			random_list = {
				25 = {
					add_treasury = 15
				}
				25 = {
					add_treasury = 30
				}
				25 = {
					add_treasury = 45
				}
				25 = {
					add_treasury = 60
				}
			}
			
			hidden_effect = {
				FROM = {
					province_event = {
						id = slaves.3
						days = 1
					}
				}
			}
		########################################################################
	}
	option = {
		name = "slaves.2.b" # Plunder! 
		ai_chance = { 
				factor = 50
				modifier = {
					factor = 0.5
						NOT = { mil_power = 25 }
					}
				modifier = {
					factor = 1.25
					FROM = {
						owner = { is_rival = ROOT }
						}
					} 
				modifier = {
					factor = 1.15
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 40 }
					}
				modifier = {
					factor = 1.25
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 60 }
					}
				modifier = {
					factor = 1.35
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 80 }
					}
				modifier = {
					factor = 1.45
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 100 }
					}
				modifier = {
					factor = 0.2
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = 5 } }
						}
					}
				modifier = {
					factor = 0.75
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -25 } }
						}
					}
				modifier = {
					factor = 1.5
						NOT = {
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -190 } }
							}
						}
					}
				}
		########################################################################
			add_mil_power = -25
			FROM = {
						destroy_building_25 = yes
						random = { 
							chance = 50 
							add_base_tax = -1
						}	
						random = { 
							chance = 50 
							add_base_production = -1
						}
							add_province_modifier = {
								name = ongoing_plundering
								duration = 10
							}
					hidden_effect = {
						FROM = {
								add_devastation = 10
								add_province_modifier = {
										name = was_plundered
										duration = 1825
									}
						}
					}
			}
			random_list = {
				25 = {
					add_treasury = 10
				}
				25 = {
					add_treasury = 20
				}
				25 = {
					add_treasury = 30
				}
				25 = {
					add_treasury = 40
				}
			}
			
			hidden_effect = {
				FROM = {
					province_event = {
						id = slaves.3
					}
				}
			}
		########################################################################
	}
	option = {
		name = "slaves.2.c" # leave it be! 
		ai_chance = { 
				factor = 25
				modifier = {
					factor = 3.0
						FROM = {
							any_neighbor_province = {
								num_of_units_in_province = {
									who = PREV
									amount = 4
								}
							}
						}
					}
				modifier = {
					factor = 2.0
						NOT = {
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = 10 } }
							}
						}
					}
				modifier = {
					factor = 1.5
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -25 } }
						}
					}
				modifier = {
					factor = 1.1
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 40 }
					}
				modifier = {
					factor = 1.2
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 60 }
					}
				modifier = {
					factor = 1.3
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 80 }
					}
				modifier = {
					factor = 1.4
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 100 }
					}
				modifier = {
					factor = 0.75
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -25 } }
						}
					}
				}
	}
}

########################################################################################
# Sack of City - Owner Event
########################################################################################
country_event = {
	id = slaves.3
	title = "slaves.3.t"
	desc = "slaves.3.d"
	picture = looting
	is_triggered_only = yes
	major = yes
	
	trigger = {
		always = no
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "slaves.3.a"
			add_war_exhaustion = 1 
			add_opinion = {
				who = FROM
				modifier = sacked_city_opinion
			}
	}
}

########################################################################################
# plundering of City
########################################################################################
country_event = {
	id = slaves.4
	title = "slaves.4.t"
	desc = "slaves.4.d"
	picture = plundering
	is_triggered_only = yes
	
	trigger = {
		always = no
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "slaves.4.a" # Enslave! 
		trigger = { NOT = { has_country_modifier = slavery_abolished } }
		ai_chance = { 
				factor = 50
				modifier = {
					factor = 0.5
						NOT = { mil_power = 50 }
					}
				modifier = {
					factor = 1.5
					FROM = {
						owner = { is_rival = ROOT }
						}
					} 
				modifier = {
					factor = 1.3
						NOT = { check_variable = { which = var_slaves_pop_ratio value = 20 } }
					}
				modifier = {
					factor = 1.2
						NOT = { check_variable = { which = var_slaves_pop_ratio value = 40 } }
					}
				modifier = {
					factor = 1.1
						NOT = { check_variable = { which = var_slaves_pop_ratio value = 60 } }
					}
				modifier = {
					factor = 0.8
								check_variable = { which = var_slaves_pop_ratio value = 80 }
					}
				modifier = {
					factor = 0.6
								check_variable = { which = var_slaves_pop_ratio value = 100 }
					}
				modifier = {
					factor = 0.1
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = 5 } }
						}
					}
				modifier = {
					factor = 0.5
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -25 } }
						}
					}
				modifier = {
					factor = 1.5
						NOT = {
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -190 } }
							}
						}
					}
				}
		########################################################################
			add_mil_power = -20
			change_variable = { which = slaves value = 2500 }
			FROM = {
							destroy_building_25 = yes
							if = {
								limit = { base_tax = 1 }		
							random = { 
								chance = 50 
								add_base_tax = -1
								}	
							}
							random = { 
								chance = 50
								add_base_production = -1
							}	
							add_province_modifier = {
								name = ongoing_plundering
								duration = 30
							}
					hidden_effect = {
						FROM = {
								add_devastation = 10
								add_province_modifier = {
										name = was_plundered
										duration = 3650
									}
						}
					}
			}
			random_list = {
				25 = {
					add_treasury = 5
				}
				25 = {
					add_treasury = 10
				}
				25 = {
					add_treasury = 15
				}
				25 = {
					add_treasury = 20
				}
			}
			
		########################################################################
	}
	option = {
		name = "slaves.4.b" # Plunder! 
		ai_chance = { 
				factor = 50
				modifier = {
					factor = 0.5
						NOT = { mil_power = 20 }
					}
				modifier = {
					factor = 1.25
					FROM = {
						owner = { is_rival = ROOT }
						}
					} 
				modifier = {
					factor = 1.15
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 50 }
					}
				modifier = {
					factor = 1.25
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 70 }
					}
				modifier = {
					factor = 1.35
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 90 }
					}
				modifier = {
					factor = 1.45
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 110 }
					}
				modifier = {
					factor = 0.2
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = 5 } }
						}
					}
				modifier = {
					factor = 0.75
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -25 } }
						}
					}
				modifier = {
					factor = 1.5
						NOT = {
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -190 } }
							}
						}
					}
				}
		########################################################################
			add_mil_power = -10
			FROM = {
							add_province_modifier = {
								name = ongoing_plundering
								duration = 10
							}
					hidden_effect = {
						FROM = {
								add_devastation = 5
								add_province_modifier = {
										name = was_plundered
										duration = 1825
									}
						}
					}
			}
			random_list = {
				25 = {
					add_treasury = 2.5
				}
				25 = {
					add_treasury = 5
				}
				25 = {
					add_treasury = 7.5
				}
				25 = {
					add_treasury = 10
				}
			}
			
		########################################################################
	}
	option = {
		name = "slaves.4.c" # leave it be! 
		ai_chance = { 
				factor = 25
				modifier = {
					factor = 3.0
						FROM = {
							any_neighbor_province = {
								num_of_units_in_province = {
									who = PREV
									amount = 4
								}
							}
						}
					}
				modifier = {
					factor = 2.0
						NOT = {
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = 10 } }
							}
						}
					}
				modifier = {
					factor = 1.5
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -25 } }
						}
					}
				modifier = {
					factor = 1.1
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 40 }
					}
				modifier = {
					factor = 1.2
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 60 }
					}
				modifier = {
					factor = 1.3
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 80 }
					}
				modifier = {
					factor = 1.4
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 100 }
					}
				modifier = {
					factor = 0.75
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -25 } }
						}
					}
				}
	}
}


########################################################################################
# tribal slaveraid
########################################################################################
country_event = {
	id = slaves.5
	title = "slaves.5.t"
	desc = "slaves.5.d"
	picture = plundering
	is_triggered_only = yes
	
	trigger = {
		always = no
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "slaves.5.a" # Enslave! 
		ai_chance = { 
				factor = 50
				modifier = {
					factor = 0.5
						NOT = { mil_power = 50 }
					}
				modifier = {
					factor = 1.5
					FROM = {
						owner = { is_rival = ROOT }
						}
					} 
				modifier = {
					factor = 1.3
						NOT = { check_variable = { which = var_slaves_pop_ratio value = 35 } }
					}
				modifier = {
					factor = 1.2
						NOT = { check_variable = { which = var_slaves_pop_ratio value = 50 } }
					}
				modifier = {
					factor = 1.1
						NOT = { check_variable = { which = var_slaves_pop_ratio value = 65 } }
					}
				modifier = {
					factor = 0.8
								check_variable = { which = var_slaves_pop_ratio value = 80 }
					}
				modifier = {
					factor = 0.6
								check_variable = { which = var_slaves_pop_ratio value = 95 }
					}
				modifier = {
					factor = 0.1
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = 5 } }
						}
					}
				modifier = {
					factor = 0.5
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -25 } }
						}
					}
				modifier = {
					factor = 1.5
						NOT = {
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -190 } }
							}
						}
					}
				}
		########################################################################
			add_mil_power = -10
			change_variable = { which = slaves value = 2500 }
			FROM = {
							destroy_building_25 = yes
							random = { 
								chance = 33
								add_base_manpower = -1
							}	
							add_province_modifier = {
								name = ongoing_plundering
								duration = 15
							}
					hidden_effect = {
						FROM = {
								add_devastation = 5
								add_province_modifier = {
										name = was_plundered
										duration = 1825
									}
						}
					}
			}
					add_treasury = 10
			
		########################################################################
	}
	option = {
		name = "slaves.5.b" # leave it be! 
		ai_chance = { 
				factor = 20
				modifier = {
					factor = 3.0
						FROM = {
							any_neighbor_province = {
								num_of_units_in_province = {
									who = PREV
									amount = 3
								}
							}
						}
					}
				modifier = {
					factor = 2.0
						NOT = {
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = 10 } }
							}
						}
					}
				modifier = {
					factor = 1.5
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -25 } }
						}
					}
				modifier = {
					factor = 1.1
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 40 }
					}
				modifier = {
					factor = 1.2
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 60 }
					}
				modifier = {
					factor = 1.3
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 80 }
					}
				modifier = {
					factor = 1.4
								NOT = { has_country_modifier = slavery_abolished }
								check_variable = { which = var_slaves_pop_ratio value = 100 }
					}
				modifier = {
					factor = 0.75
						FROM = { 
							owner = { reverse_has_opinion = { who = ROOT value = -25 } }
						}
					}
				}
	}
}

########################################################################################
# slave uprising
########################################################################################
country_event = {
	id = slaves.6
	title = "slaves.6.t"
	desc = "slaves.6.d"
	picture = civilwar
	is_triggered_only = yes
	
	trigger = {
		always = no
	}
	
	mean_time_to_happen = {
		days = 1
		modifier = {
			factor = 2.0
			check_variable = { which = var_slaves_pop_ratio value = 33 }
		}
		modifier = {
			factor = 2.0
			check_variable = { which = var_slaves_pop_ratio value = 66 }
		}
	}
	
	immediate = {
		hidden_effect = {
			save_event_target_as = slave_leader_origin #Fallback
			random_neighbor_country = {
				save_event_target_as = slave_leader_origin
			}
			
				set_saved_name = {
					key = slave_leader_name
					type = advisor
					scope = event_target:slave_leader_origin
				}
				
			random_owned_province = {
				limit = {
					 is_in_capital_area = yes 
				}
				save_event_target_as = slave_uprising_target
			}
		}
	}
	
	option = {
		name = "slaves.6.a"
			change_variable = { slaves = -2500 }
			event_target:slave_uprising_target = {
				spawn_rebels = {
						size = 1
						leader = slave_leader_name
						type = slave_rebels
					}
			}
	}
	after = {
		clear_saved_name = slave_leader_name
	}
}

########################################################################################
# slaves run away
########################################################################################
country_event = {
	id = slaves.7
	title = "slaves.7.t"
	desc = "slaves.7.d"
	picture = slaves
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_country_modifier = slavery_abolished }
		check_variable = { which = var_slaves_pop_ratio value = 5 }
		check_variable = { which = slaves value = 2000 }
	}
	
	mean_time_to_happen = {
		days = 1
		modifier = {
			factor = 2.0
			check_variable = { which = var_slaves_pop_ratio value = 40 }
		}
		modifier = {
			factor = 2.0
			check_variable = { which = var_slaves_pop_ratio value = 80 }
		}
	}

	option = {
		name = "slaves.7.a"
			if = {
				limit = { 
					check_variable = { which = slaves value = 40000 }
				}
					change_variable = { slaves = -3000 }
				else = {
					if = {
						limit = { 
							check_variable = { which = slaves value = 20000 }
						}
							change_variable = { slaves = -2000 }
						else = {
								change_variable = { slaves = -1000 }
						}
					}
				}
			}
	}
}

########################################################################################
# 
########################################################################################
country_event = {
	id = slaves.8
	title = "slaves.8.t"
	desc = "slaves.8.d"
	picture = slaves
	is_triggered_only = yes	# added so that it doesn't fire
	# fire_only_once = yes
	# hidden = yes
	
	trigger = {
		#always = yes		# slaves are back, baby! No need for that again
	}
	
	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = "slaves.7.a"
		every_country = {
			add_country_modifier = {
				name = slavery_abolished
				duration = -1
				hidden = yes
			}
			if = {
				limit = { has_country_modifier = debt_bondage_banned }
				remove_country_modifier = debt_bondage_banned
			}
			set_variable = { which = slaves value = 0 }
		}
	}
}

###
# DEBUG TOOLS FOR SLAVE EVENTS
###
country_event = {
	id = slaves.9
	title = "slaves.9.t"
	desc = "slaves.9.d"
	picture = slaves
	is_triggered_only = yes	# Only by console command
	
	immediate = {
		# Prepare initial slave count
		set_variable = { which = slaves_in_province value = 0 }		# reset at country level
		every_owned_province = {
			limit = { check_variable = { slaves_in_province = 0.1 } }	# any province with slaves there
			owner = { change_variable = { which = slaves_in_province which = PREV } }
		}
		set_variable = { which = slave_total which = slaves }
		change_variable = { which = slave_total which = slaves_in_province }
		
		# Population
		export_to_variable = { which = var_total_pop value = total_development }
		multiply_variable = { var_total_pop = 10 }									# population in thousands, now
			
		slaves_remove_basic_modifiers = yes
		slaves_remove_complex_modifiers = yes
		
	}
	
	# Every option will update the modifier (the x/y matrix)
	
	option = {
		name = "slaves.9.1"	# Fill all manufactories
		while = {
			limit = {
				check_variable = { slaves = 10 }
				any_owned_province = { check_variable = { SS_slot_free = 1 } }
			}
			random_owned_province = {
				limit = { check_variable = { SS_slot_free = 1 } }
				owner = { subtract_variable = { slaves = 10 } change_variable = { slaves_in_province = 10 } }
				change_variable = { slaves_in_province = 10 }
				subtract_variable = { SS_slot_free = 1 } change_variable = { SS_slot_taken = 1 }
				SD_update_prov_output = yes
			}
		}
		
	}
	
	option = {
		name = "slaves.9.2"	# Remove all from manufactories
		every_owned_province = {
			limit = { check_variable = { slaves_in_province = 1 } }
			set_variable = { which = slaves which = slaves_in_province } 
			set_variable = { which = slaves_in_province value = 0 }
			owner = { change_variable = { which = slaves which = PREV } }
			change_variable = { which = SS_slot_free which = SS_slot_taken } 
			set_variable = { which = SS_slot_taken value = 0 }
			set_variable = { which = SD_slave_output value = 0 }
			set_variable = { which = slaves value = 0 }
			SS_remove_manuf_modifiers = yes
		}
		
	}
	
	option = {
		name = "slaves.9.3"	# Add +20% of slave population
		set_variable = { which = slaves_new which = slave_total }
		multiply_variable = { slaves_new = 0.2 }  change_variable = { which = slaves which = slaves_new }
		multiply_variable = { slave_total = 1.2 } set_variable = { which = slaves_new value = 0 }
		
	}
	option = {
		name = "slaves.9.4"	# Add +50% of slave population
		set_variable = { which = slaves_new which = slave_total }
		multiply_variable = { slaves_new = 0.5 }  change_variable = { which = slaves which = slaves_new }
		multiply_variable = { slave_total = 1.5 } set_variable = { which = slaves_new value = 0 }
		
	}
	option = {
		name = "slaves.9.5"	# Add +100% of slave population
		set_variable = { which = slaves_new which = slave_total }
		change_variable = { which = slaves which = slaves_new }
		multiply_variable = { slave_total = 2.0 } set_variable = { which = slaves_new value = 0 }
		
	}
	option = {
		name = "slaves.9.6" # Nothing
		
	}
	
	after = {
	
		# Update the modifier (update populations, update flags, then find coordinates, finally show x/y modifier)
		set_variable = { which = slave_pop_social which = slave_total } 
		divide_variable = { which = slave_pop_social which = var_total_pop } # slave percentage
		multiply_variable = { slave_pop_social = 100 }						 # to be in percentage (1 to 100), not units (0,x to 1,0)
		export_to_variable = { which = slave_pop_economic value = modifier:slavesmod_productivity }	# repurposed for Slave Productivity
		change_variable = { slave_pop_economic = 1 }
		multiply_variable = { which = slave_pop_economic which = slaves }		# Slaves, not slaves + manufactories. Only "idle" slaves
		divide_variable = { which = slave_pop_economic which = var_total_pop }  # slave percentage
		multiply_variable = { slave_pop_economic = 100 }						# to be in percentage (1 to 100)
		
		slaves_find_coordinates = yes
		slaves_ratio_create_high = yes	
		
		# Show variables for display
		set_variable = { which = slaves_tot_display which = slaves } 
		change_variable = { which = slaves_tot_display which = slaves_in_province }
		multiply_variable = { slaves_tot_display = 0.001 }			multiply_variable = { slaves_tot_display = 1000 }
		set_variable = { which = slaves_oth_disp which = slaves } 
		multiply_variable = { slaves_oth_disp = 0.001 }			 	multiply_variable = { slaves_oth_disp = 1000 }
		set_variable = { which = slaves_mnf_display which = slaves_in_province } 
		multiply_variable = { slaves_mnf_display = 0.001 }			multiply_variable = { slaves_mnf_display = 1000 }
		export_to_variable = { which = slave_productivity value = modifier:slavesmod_productivity }		  # for display purposes
		change_variable = { slave_productivity = 1 } multiply_variable = { slave_productivity = 100 } # to be in percentage (1 to 100)

	}
}
